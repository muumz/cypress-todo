trigger:
  - master
jobs:
  - job: Job_1
    displayName: Agent job 1
    pool:
      vmImage: vs2017-win2016
    steps:
      - checkout: self
      - task: NodeTool@0
        displayName: Use Node version
        inputs:
          versionSpec: 12.x
      - task: npmAuthenticate@0
        inputs:
          workingFile: .npmrc
      - task: Npm@0
        displayName: Install application dependencies
        inputs:
          arguments: --force
      - task: Npm@1
        displayName: npm run test
        inputs:
          command: custom
          customCommand: run ci:unit
      - task: Npm@1
        displayName: npm run cypress
        inputs:
          command: custom
          customCommand: run ci:cypress
      - task: Npm@1
        displayName: npm build
        inputs:
          command: custom
          verbose: false
          customCommand: run build
      - task: AzureRmWebAppDeployment@4
        displayName: "Azure App Service Deploy"
        inputs:
          ConnectedServiceName: <YOUR_CONNECTION>
          WebAppKind: webAppLinux
          WebAppName: <YOUR_APP_ID>
          Package: $(System.DefaultWorkingDirectory)/build
          InlineScript: >2

      - task: ArchiveFiles@1
        displayName: Archive files
        inputs:
          archiveType: zip
      - task: PublishBuildArtifacts@1
        displayName: "Publish Artifact: drop"
